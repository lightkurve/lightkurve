
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Removing noise from K2 and TESS light curves using Pixel Level Decorrelation (PLDCorrector) &#8212; Lightkurve </title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/nbsphinx-code-cells.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Removing noise from K2 light curves using Self Flat Fielding (SFFCorrector)" href="2-3-k2-sffcorrector.html" />
    <link rel="prev" title="Removing scattered light from TESS light curves using linear regression (RegressionCorrector)" href="2-3-removing-scattered-light-using-regressioncorrector.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-69171-9', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    
<a class="navbar-brand" href="../../index.html">
<p class="title">Lightkurve v2.5</p>
</a>

    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../whats-new-v2.html">
  What's new?
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../quickstart.html">
  Quickstart
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../index.html">
  Tutorials
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../reference/index.html">
  API
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../about/index.html">
  About Lightkurve
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../../development/index.html">
  Developing for Lightkurve
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/lightkurve/lightkurve" rel="noopener" target="_blank" title="GitHub"><span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <div class="col-12 col-md-1 col-xl-2 bd-sidebar no-sidebar"></div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage mt-5 pt-1 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Learning-Goals">
   Learning Goals
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Introduction">
   Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Imports">
   Imports
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#1.-Applying-PLD-to-a-K2-Light-Curve">
   1. Applying PLD to a
   <em>
    K2
   </em>
   Light Curve
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#2.-Diagnosing-the-Success-of-the-Correction">
   2. Diagnosing the Success of the Correction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#3.-How-to-Avoid-Overfitting-Exoplanet-Transits">
   3. How to Avoid Overfitting Exoplanet Transits
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#3.1-Overfitting">
     3.1 Overfitting
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#4.-Applying-PLD-to-a-TESS-Light-Curve">
   4. Applying PLD to a
   <em>
    TESS
   </em>
   Light Curve
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#5.-Tuning-PLDCorrector-Using-Optional-Parameters">
   5. Tuning
   <code class="docutils literal notranslate">
    <span class="pre">
     PLDCorrector
    </span>
   </code>
   Using Optional Parameters
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#5.1-Definitions-of-all-additional-parameters">
     5.1 Definitions of all additional parameters
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#6.-Frequently-Asked-Questions">
   6. Frequently Asked Questions
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#About-this-Notebook">
   About this Notebook
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Citing-Lightkurve-and-Astropy">
   Citing Lightkurve and Astropy
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-11 col-xl-8 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <div style="float:right; margin-bottom:1em;">
    <a href="https://github.com/lightkurve/lightkurve/raw/main/docs/source/tutorials/2-creating-light-curves/2-3-k2-pldcorrector.ipynb"><img src="https://img.shields.io/badge/Notebook-Download-130654?logo=Jupyter&labelColor=fafafa"></a>
    <a href="https://timeseries.science.stsci.edu/hub/user-redirect/git-pull?repo=https%3A%2F%2Fgithub.com%2Flightkurve%2Flightkurve&urlpath=lab%2Ftree%2Flightkurve%2Fdocs%2Fsource%2Ftutorials/2-creating-light-curves/2-3-k2-pldcorrector.ipynb&branch=main"><img src="https://img.shields.io/badge/Notebook-Open%20in%20TIKE-130654?logo=Jupyter&labelColor=fafafa"></a>
</div>
<br style="clear:both;"><section id="Removing-noise-from-K2-and-TESS-light-curves-using-Pixel-Level-Decorrelation-(PLDCorrector)">
<h1>Removing noise from <em>K2</em> and <em>TESS</em> light curves using Pixel Level Decorrelation (<code class="docutils literal notranslate"><span class="pre">PLDCorrector</span></code>)<a class="headerlink" href="#Removing-noise-from-K2-and-TESS-light-curves-using-Pixel-Level-Decorrelation-(PLDCorrector)" title="Permalink to this headline">#</a></h1>
<section id="Learning-Goals">
<h2>Learning Goals<a class="headerlink" href="#Learning-Goals" title="Permalink to this headline">#</a></h2>
<p>By the end of this tutorial, you will:</p>
<ul class="simple">
<li><p>Understand how to apply the <a class="reference external" href="https://docs.lightkurve.org">Lightkurve</a> <a class="reference external" href="https://docs.lightkurve.org/reference/api/lightkurve.correctors.PLDCorrector.html?highlight=pldcorrector">PLDCorrector</a> tool to remove instrumental noise from <em>K2</em> and <em>TESS</em> light curves.</p></li>
<li><p>Be able to create an exoplanet transit mask and use it to improve PLD.</p></li>
<li><p>Be aware of common issues, caveats, and potential biases associated with the use of PLD.</p></li>
</ul>
</section>
<section id="Introduction">
<h2>Introduction<a class="headerlink" href="#Introduction" title="Permalink to this headline">#</a></h2>
<p>The <a class="reference external" href="https://archive.stsci.edu/k2">K2</a> and <a class="reference external" href="https://archive.stsci.edu/tess">TESS</a> missions both provide high-precision photometry for thousands of exoplanet candidates. However, observations by both telescopes can be muddled by instrumental systematic trends, making exoplanet detection or stellar characterization difficult.</p>
<p>Pixel Level Decorrelation (PLD) is a method that has primarily been used to remove systematic trends introduced by small spacecraft motions during observations, and has been shown to be successful at improving the precision of data taken by the <em>Spitzer</em> space telescope (<a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2015ApJ...805..132D/abstract">Deming et al. 2015</a>) and the <em>K2</em> mission (<a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2016AJ....152..100L/abstract">Luger et al. 2016</a>;
<a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2018AJ....156...99L/abstract">2018</a>). PLD works by identifying a set of trends in the pixels surrounding the target star, and performing linear regression to create a combination of these trends that effectively models the systematic noise introduced by spacecraft motion. This noise model is then subtracted from the uncorrected light curve.</p>
<p>This method has been shown to be very effective at removing the periodic systematic trends in <em>K2</em>, and can also help remove the scattered light background signal in <em>TESS</em> observations. This tutorial will demonstrate how to use the <a class="reference external" href="https://docs.lightkurve.org">Lightkurve</a> <a class="reference external" href="https://docs.lightkurve.org/reference/api/lightkurve.correctors.PLDCorrector.html?highlight=pldcorrector">PLDCorrector</a> for each mission, and will give advice on how to best implement PLD. The
<a class="reference external" href="https://docs.lightkurve.org/reference/api/lightkurve.correctors.PLDCorrector.html?highlight=pldcorrector">PLDCorrector</a> is a special case of the <a class="reference external" href="https://docs.lightkurve.org">Lightkurve</a> <a class="reference external" href="https://docs.lightkurve.org/reference/api/lightkurve.correctors.RegressionCorrector.html?highlight=regressioncorrector">RegressionCorrector</a>. For more information on how to use
<a class="reference external" href="https://docs.lightkurve.org/reference/api/lightkurve.correctors.RegressionCorrector.html?highlight=regressioncorrector">RegressionCorrector</a> to choose custom regressors and remove scattered light from <em>TESS</em>, please see the tutorial specifically on removing scattered light from <em>TESS</em> data using the Lightkurve <a class="reference external" href="https://docs.lightkurve.org/reference/api/lightkurve.correctors.RegressionCorrector.html?highlight=regressioncorrector">RegressionCorrector</a>.</p>
<p>Before reading this tutorial, it is recommended to first familiarize yourself with using target pixel file (TPF) products and light curve products with Lightkurve.</p>
</section>
<section id="Imports">
<h2>Imports<a class="headerlink" href="#Imports" title="Permalink to this headline">#</a></h2>
<p>We only need to import the <a class="reference external" href="https://docs.lightkurve.org">Lightkurve</a> package for this tutorial, which in turn uses <a class="reference external" href="https://matplotlib.org/">Matplotlib</a> for plotting.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">lightkurve</span> <span class="k">as</span> <span class="nn">lk</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
<hr class="docutils" />
</section>
<section id="1.-Applying-PLD-to-a-K2-Light-Curve">
<h2>1. Applying PLD to a <em>K2</em> Light Curve<a class="headerlink" href="#1.-Applying-PLD-to-a-K2-Light-Curve" title="Permalink to this headline">#</a></h2>
<p>The dominant source of noise in <em>K2</em> data is created by the motion of the <em>Kepler</em> spacecraft due to periodic thruster firings. This causes stars to drift across different pixels on the detector, which have varied sensitivity. There are two classes of sensitivity variation on a charge-couped device (CCD) detector — variation between pixels (inter-pixel) and variation within each pixel (intra-pixel). Both inter- and intra-pixel sensitivity variations are present on the <em>Kepler</em> detector, which
ultimately causes different flux levels to be detected as the target’s Point Spread Function (PSF) drifts across the variations, introducing the systematic trends.</p>
<p>The <a class="reference external" href="https://docs.lightkurve.org/reference/api/lightkurve.correctors.PLDCorrector.html?highlight=pldcorrector">PLDCorrector</a> uses information from nearby pixels to create a noise model, so we need to use the <a class="reference external" href="https://docs.lightkurve.org/reference/targetpixelfile.html?highlight=targetpixelfile">TargetPixelFile</a> data product (for more information, see the tutorial on using <em>Kepler</em> target pixel file products). We can use the
<a class="reference external" href="https://docs.lightkurve.org/reference/api/lightkurve.search_targetpixelfile.html?highlight=search_targetpixelfile">search_targetpixelfile</a> method to identify available observations for the desired target, and the <a class="reference external" href="https://docs.lightkurve.org/reference/search.html?highlight=download">download</a> method to access the data.</p>
<p>In what follows below, we will demonstrate PLD on the exoplanet system K2-199, which was observed during <em>K2</em> Campaign 6. We can download the pixel data as follows:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tpf</span> <span class="o">=</span> <span class="n">lk</span><span class="o">.</span><span class="n">search_targetpixelfile</span><span class="p">(</span><span class="s1">&#39;K2-199&#39;</span><span class="p">,</span> <span class="n">author</span><span class="o">=</span><span class="s1">&#39;K2&#39;</span><span class="p">,</span> <span class="n">campaign</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span><span class="o">.</span><span class="n">download</span><span class="p">()</span>
<span class="n">tpf</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_2-creating-light-curves_2-3-k2-pldcorrector_7_0.png" src="../../_images/tutorials_2-creating-light-curves_2-3-k2-pldcorrector_7_0.png" />
</div>
</div>
<p>There are two ways to create a <code class="docutils literal notranslate"><span class="pre">PLDCorrector</span></code> object. The first is to create an instance of the class directly and pass in the <code class="docutils literal notranslate"><span class="pre">TargetPixelFile</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">lightkurve.correctors</span> <span class="kn">import</span> <span class="n">PLDCorrector</span>
<span class="n">pld</span> <span class="o">=</span> <span class="n">PLDCorrector</span><span class="p">(</span><span class="n">tpf</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pld</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
PLDCorrector (ID: EPIC 212779596)
</pre></div></div>
</div>
<p>For convenience, you can also use the <a class="reference external" href="https://docs.lightkurve.org/reference/api/lightkurve.LightCurve.to_corrector.html?highlight=to_corrector#lightkurve.LightCurve.to_corrector">to_corrector</a> method of the <code class="docutils literal notranslate"><span class="pre">TargetPixelFile</span></code> object, and pass in the string <code class="docutils literal notranslate"><span class="pre">'pld'</span></code> to specify the desired corrector type.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pld</span> <span class="o">=</span> <span class="n">tpf</span><span class="o">.</span><span class="n">to_corrector</span><span class="p">(</span><span class="s1">&#39;pld&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pld</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
PLDCorrector (ID: EPIC 212779596)
</pre></div></div>
</div>
<p>Both of these approaches return an identical <code class="docutils literal notranslate"><span class="pre">PLDCorrector</span></code> object. From here, getting a corrected light curve is possible: call the <code class="docutils literal notranslate"><span class="pre">correct</span></code> method.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corrected_lc</span> <span class="o">=</span> <span class="n">pld</span><span class="o">.</span><span class="n">correct</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Now we can compare the output of PLD to an uncorrected light curve. To create the uncorrected light curve, we can use the <code class="docutils literal notranslate"><span class="pre">to_lightcurve</span></code> method of the <a class="reference external" href="https://docs.lightkurve.org/reference/api/lightkurve.KeplerTargetPixelFile.html?highlight=keplertargetpixelfile">KeplerTargetPixelFile</a> object, which performs simple aperture photometry (SAP) to create a light curve from the pixel data.</p>
<p>Below, the uncorrected light curve is shown in red and the PLD-corrected light curve is plotted in black.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create and plot an uncorrected light curve using Simple Aperture Photometry</span>
<span class="n">uncorrected_lc</span> <span class="o">=</span> <span class="n">tpf</span><span class="o">.</span><span class="n">to_lightcurve</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">uncorrected_lc</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Uncorrected Light Curve&#39;</span><span class="p">);</span>
<span class="c1"># Plot the PLD-corrected light curve in black on top</span>
<span class="n">corrected_lc</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span><span class="o">.</span><span class="n">remove_outliers</span><span class="p">()</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;PLD-corrected Light Curve&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_2-creating-light-curves_2-3-k2-pldcorrector_15_0.png" src="../../_images/tutorials_2-creating-light-curves_2-3-k2-pldcorrector_15_0.png" />
</div>
</div>
<p>The uncorrected light curve is dominated by a short period (about six hours) sawtooth-shaped pattern caused by the <em>Kepler</em> spacecraft thruster firings. PLD captures this trend in the noise model and has subtracted it, leaving the much more accurate light curve in black.</p>
<p>We can quantify the improvement by comparing the Combined Differential Photometric Precision (CDPP) values for each light curve.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">uncorrected_cdpp</span> <span class="o">=</span> <span class="n">uncorrected_lc</span><span class="o">.</span><span class="n">estimate_cdpp</span><span class="p">()</span>
<span class="n">corrected_cdpp</span> <span class="o">=</span> <span class="n">corrected_lc</span><span class="o">.</span><span class="n">estimate_cdpp</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Uncorrected CDPP = </span><span class="si">{</span><span class="n">uncorrected_cdpp</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Corrected CDPP = </span><span class="si">{</span><span class="n">corrected_cdpp</span><span class="si">:</span><span class="s2">.0f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Uncorrected CDPP = 2928 ppm
Corrected CDPP = 105 ppm
</pre></div></div>
</div>
<p>By this metric, the photometric precision improved by more than a factor of 25 after applying PLD.</p>
<p>Another important trait of PLD is that long-term variability trends in the light curve are preserved. In this example, we can see the stellar rotation of K2-199 as the sinusoidal signal left in the light curve after correction. This is done by fitting a polynomial spline model to the light curve while simultaneously fitting the noise model, because the uncorrected observation is a combination of the signals.</p>
</section>
<section id="2.-Diagnosing-the-Success-of-the-Correction">
<h2>2. Diagnosing the Success of the Correction<a class="headerlink" href="#2.-Diagnosing-the-Success-of-the-Correction" title="Permalink to this headline">#</a></h2>
<p>The success of PLD depends on a number of factors including the brightness of the object, the choice of pixels used to create the light curve and the noise model, and whether or not there exists a correlation between the instrumental noise and the astrophysical signals. For these reasons, it is important to carefully review the correct operation of the algorithm each time you use it, and tune the optional parameters of the algorithm if necessary.</p>
<p>The most convenient way to diagnose the performance of PLD is to use the <a class="reference external" href="https://docs.lightkurve.org/reference/api/lightkurve.correctors.PLDCorrector.diagnose.html?highlight=diagnose#lightkurve.correctors.PLDCorrector.diagnose">diagnose()</a> method, which generates a set of diagnostic plots which we will explain below the graph.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pld</span><span class="o">.</span><span class="n">diagnose</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_2-creating-light-curves_2-3-k2-pldcorrector_20_0.png" src="../../_images/tutorials_2-creating-light-curves_2-3-k2-pldcorrector_20_0.png" />
</div>
</div>
<p>The diagnostic plot is composed of the following panels: - <strong>Top panel</strong>: The uncorrected light curve (<code class="docutils literal notranslate"><span class="pre">original</span></code>) is shown in black, with the Combined Differential Photometric Precision (CDPP), a measurement of the light curve’s scatter, noted in the legend. - <strong>Middle panel</strong>: The PLD-corrected light curve (<code class="docutils literal notranslate"><span class="pre">corrected</span></code>) is plotted in gray with the noise model created by the combination of pixel values (<code class="docutils literal notranslate"><span class="pre">pixel_series</span></code>) in blue, the estimated background trend (<code class="docutils literal notranslate"><span class="pre">background</span></code>) in red, and
the polynomial spline fit to the stellar variability (<code class="docutils literal notranslate"><span class="pre">spline</span></code>) in yellow. For <em>K2</em>, the background signal is minimal compared to the systematic trends due to motion, but it is much more significant for <em>TESS</em> observations. Notice that the corrected light curve closely matches the spline, which is tracing the preserved stellar variability. - <strong>Bottom panel</strong>: A direct comparison between the uncorrected light curve (<code class="docutils literal notranslate"><span class="pre">original</span></code>) and the PLD-corrected light curve (<code class="docutils literal notranslate"><span class="pre">corrected</span></code>), again noting
the CDPP of each light curve in the legend. This panel also indicates which cadences were flagged as outliers (<code class="docutils literal notranslate"><span class="pre">outlier_mask</span></code>), which lie greater than five standard deviations above or below the light curve, as well as which cadences are excluded from the spline fit (<code class="docutils literal notranslate"><span class="pre">~cadence_mask</span></code>). As we will see below, <code class="docutils literal notranslate"><span class="pre">cadence_mask</span></code> is a Boolean array with the same length as the <code class="docutils literal notranslate"><span class="pre">TargetPixelFile</span></code>’s time array, where <code class="docutils literal notranslate"><span class="pre">True</span></code> is included in the spline fit and <code class="docutils literal notranslate"><span class="pre">False</span></code> is excluded. The tilde (<code class="docutils literal notranslate"><span class="pre">~</span></code>)
indicates that the inverse of the mask is marked in this plot, that is, the excluded cadences will be crossed out in blue.</p>
<p>The plot above makes it convenient to review the components of the noise removal algorithm. The performance of the algorithm is strongly affected by the choice of pixels which go into the model components. To diagnose this part of the algorithm, we can use the <code class="docutils literal notranslate"><span class="pre">diagnose_masks</span></code> method:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pld</span><span class="o">.</span><span class="n">diagnose_masks</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_2-creating-light-curves_2-3-k2-pldcorrector_23_0.png" src="../../_images/tutorials_2-creating-light-curves_2-3-k2-pldcorrector_23_0.png" />
</div>
</div>
<p>The panels in the figure visualize the following pixel masks:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">aperture_mask</span></code>: Pixels used to create the SAP flux light curve from which the noise model is subtracted.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pld_aperture_mask</span></code>: Pixels used to create the correlated noise model.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">background_aperture_mask</span></code>: Pixels used to create the background model.</p></li>
</ul>
<p>You can alter the <code class="docutils literal notranslate"><span class="pre">pld_aperture_mask</span></code> and <code class="docutils literal notranslate"><span class="pre">background_aperture_mask</span></code> by passing them as optional arguments to the <code class="docutils literal notranslate"><span class="pre">correct()</span></code> method we used earlier. For more information about these masks, and how to use them effectively, please see the full list of optional parameters and FAQ at the end of this tutorial.</p>
</section>
<section id="3.-How-to-Avoid-Overfitting-Exoplanet-Transits">
<h2>3. How to Avoid Overfitting Exoplanet Transits<a class="headerlink" href="#3.-How-to-Avoid-Overfitting-Exoplanet-Transits" title="Permalink to this headline">#</a></h2>
<p>In the example above, it looks like PLD did a great job of removing the instrumental noise introduced by the <em>K2</em> detector drift, but the bottom panel of the diagnostic plot seems to indicate that we’ve falsely labeled in-transit data points as outliers. To alleviate this, we can introduce the <code class="docutils literal notranslate"><span class="pre">cadence_mask</span></code>.</p>
<section id="3.1-Overfitting">
<h3>3.1 Overfitting<a class="headerlink" href="#3.1-Overfitting" title="Permalink to this headline">#</a></h3>
<p>It’s necessary to mask out transits and flares when fitting the spline. The spline term fits a polynomial to the long-term trend of the light curve, and the highest likelihood solution generally follows the median of the corrected light curve. The presence of transits or flares can pull the median of the light curve down or up, respectively, causing the spline to deviate from the underlying stellar trend.</p>
<p>In practice, this causes transits to be partially “fit out” by the spline, reducing their depth and giving an incorrect estimate of the planet’s radius.</p>
<p>You can use a custom <code class="docutils literal notranslate"><span class="pre">cadence_mask</span></code> by creating a Boolean array with one value per cadence, where <code class="docutils literal notranslate"><span class="pre">True</span></code> indicates a cadence you wish to include and <code class="docutils literal notranslate"><span class="pre">False</span></code> means that the cadence is masked out.</p>
<p>For this example, we want to be sure that the in-transit cadences are not marked as outliers or used in the spline fit, as they can cause the spline to erroneously deviate from the stellar signal. To accomplish this, we can create a transit mask using the <code class="docutils literal notranslate"><span class="pre">create_transit_mask</span></code> method of the <code class="docutils literal notranslate"><span class="pre">LightCurve</span></code> object, using the known parameters of the planet system:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">transit_mask</span> <span class="o">=</span> <span class="n">corrected_lc</span><span class="o">.</span><span class="n">create_transit_mask</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="p">[</span><span class="mf">3.2277</span><span class="p">,</span> <span class="mf">7.3745</span><span class="p">],</span>
                                                <span class="n">duration</span><span class="o">=</span><span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">],</span>
                                                <span class="n">transit_time</span><span class="o">=</span><span class="p">[</span><span class="mf">2385.6635</span><span class="p">,</span> <span class="mf">2389.9635</span><span class="p">])</span>
</pre></div>
</div>
</div>
<p>We can double-check to make sure the transit mask looks good by plotting it on top of the corrected light curve in red:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">corrected_lc</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Corrected Light Curve&#39;</span><span class="p">)</span>
<span class="n">corrected_lc</span><span class="p">[</span><span class="n">transit_mask</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;transit_mask&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_2-creating-light-curves_2-3-k2-pldcorrector_28_0.png" src="../../_images/tutorials_2-creating-light-curves_2-3-k2-pldcorrector_28_0.png" />
</div>
</div>
<p>The red points appear to match the in-transit cadences for both of the planets around K2-199.</p>
<p>An additional option for the <code class="docutils literal notranslate"><span class="pre">PLDCorrector</span></code> is the ability to remove the long-term trend. This is ideal for planet candidates, which can be more difficult to detect in the presence of stellar variability. Here, we can set the <code class="docutils literal notranslate"><span class="pre">restore_trend</span></code> parameter to <code class="docutils literal notranslate"><span class="pre">False</span></code> in order to return a light curve with the long-period trend removed.</p>
<p>Now, we can call the <code class="docutils literal notranslate"><span class="pre">correct</span></code> method of the <code class="docutils literal notranslate"><span class="pre">PLDCorrector</span></code> again, this time passing in our <code class="docutils literal notranslate"><span class="pre">cadence_mask</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">corrected_lc</span> <span class="o">=</span> <span class="n">pld</span><span class="o">.</span><span class="n">correct</span><span class="p">(</span><span class="n">cadence_mask</span><span class="o">=~</span><span class="n">transit_mask</span><span class="p">,</span> <span class="n">restore_trend</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">pld</span><span class="o">.</span><span class="n">diagnose</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_2-creating-light-curves_2-3-k2-pldcorrector_30_0.png" src="../../_images/tutorials_2-creating-light-curves_2-3-k2-pldcorrector_30_0.png" />
</div>
</div>
<p>Now, only points that are greater than five standard deviations above or below the light curve but not in-transit will be marked as outliers, and the in-transit points (marked in blue in the bottom panel) will not be used to fit the spline.</p>
<p>If we examine the light curve and its cadence mask again, we will see that the long-period trend has been removed, and the transits are clearly visible by eye.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">corrected_lc</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Corrected Light Curve&#39;</span><span class="p">)</span>
<span class="n">corrected_lc</span><span class="p">[</span><span class="n">transit_mask</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;transit_mask&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_2-creating-light-curves_2-3-k2-pldcorrector_32_0.png" src="../../_images/tutorials_2-creating-light-curves_2-3-k2-pldcorrector_32_0.png" />
</div>
</div>
<p>This correction looks great! We have demonstrated that PLD is effective at removing systematic trends in <em>K2</em> data. Now, let’s apply PLD to <em>TESS</em> observations.</p>
</section>
</section>
<section id="4.-Applying-PLD-to-a-TESS-Light-Curve">
<h2>4. Applying PLD to a <em>TESS</em> Light Curve<a class="headerlink" href="#4.-Applying-PLD-to-a-TESS-Light-Curve" title="Permalink to this headline">#</a></h2>
<p><em>TESS</em> has multiple observing modes. For example, there are two-minute cadence observations, which were retrieved for specific targeted objects, and there are 30-minute cadence Full Frame Images (FFIs), which capture the entire <em>TESS</em> field of view.</p>
<p>In this example, we will examine a target using the FFI observation. The <em>TESS</em> FFIs are dominated by the scattered light background signal on the <em>TESS</em> detector, which creates high-amplitude, periodic variation. This background can make planet detection difficult, but it can be removed using PLD.</p>
<p>To access FFI data, we will use the <a class="reference external" href="https://mast.stsci.edu/tesscut/">TESScut</a> tool on the Mikulski Archive for Space Telescopes (MAST), developed by <a class="reference external" href="https://ui.adsabs.harvard.edu/abs/2019ascl.soft05007B/abstract">Brasseur et al. 2019</a>. Lightkurve has a built-in search method for creating cutouts called <a class="reference external" href="https://docs.lightkurve.org/reference/api/lightkurve.search_tesscut.html?highlight=search_tesscut">search_tesscut</a>, which uses the same syntax as the
<a class="reference external" href="https://docs.lightkurve.org/reference/api/lightkurve.search_targetpixelfile.html?highlight=search_targetpixelfile">search_targetpixelfile</a> method above. We will search for the Wolf-Rayet star WR 40, which was observed by <em>TESS</em> in Sector 10.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">search_result</span> <span class="o">=</span> <span class="n">lk</span><span class="o">.</span><span class="n">search_tesscut</span><span class="p">(</span><span class="s1">&#39;WR40&#39;</span><span class="p">,</span> <span class="n">sector</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">search_result</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
SearchResult containing 1 data products.

<table id="table13158896144">
<thead><tr><th>#</th><th>mission</th><th>year</th><th>author</th><th>exptime</th><th>target_name</th><th>distance</th></tr></thead>
<thead><tr><th></th><th></th><th></th><th></th><th>s</th><th></th><th>arcsec</th></tr></thead>
<tr><td>0</td><td>TESS Sector 10</td><td>2019</td><td><a href='https://mast.stsci.edu/tesscut/'>TESScut</a></td><td>1426</td><td>WR40</td><td>0.0</td></tr>
</table></div>
</div>
<p>We can download the pixel data with the <a class="reference external" href="https://docs.lightkurve.org/reference/search.html?highlight=download">download</a> method. When using TESScut, this method takes the additional parameter <code class="docutils literal notranslate"><span class="pre">cutout_size</span></code>, which determines how many pixels each side length of the cutout target pixel file should have.</p>
<p>Here, we use seven pixels on each side, which strikes a good balance between downloading enough pixels to create a good background model, and not downloading too many pixels, which can result in the corrector running slowly or including neighboring stars in the noise model.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tpf</span> <span class="o">=</span> <span class="n">search_result</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="n">cutout_size</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>
<span class="n">tpf</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_2-creating-light-curves_2-3-k2-pldcorrector_38_0.png" src="../../_images/tutorials_2-creating-light-curves_2-3-k2-pldcorrector_38_0.png" />
</div>
</div>
<p>We can create an uncorrected SAP light curve from this target pixel file using a threshold mask.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">uncorrected_lc</span> <span class="o">=</span> <span class="n">tpf</span><span class="o">.</span><span class="n">to_lightcurve</span><span class="p">(</span><span class="n">aperture_mask</span><span class="o">=</span><span class="s1">&#39;threshold&#39;</span><span class="p">)</span>
<span class="n">uncorrected_lc</span><span class="o">.</span><span class="n">plot</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_2-creating-light-curves_2-3-k2-pldcorrector_40_0.png" src="../../_images/tutorials_2-creating-light-curves_2-3-k2-pldcorrector_40_0.png" />
</div>
</div>
<p>The dominant trend in the SAP light curve above is the dramatic ramp up in flux due to the scattered light background on the <em>TESS</em> detector. The pulsation signal of WR 40 can also be seen clearly, with some additional long-period variability.</p>
<p>We will create a <a class="reference external" href="https://docs.lightkurve.org/reference/api/lightkurve.correctors.PLDCorrector.html?highlight=pldcorrector">PLDCorrector</a> object, and use the default values for <a class="reference external" href="https://docs.lightkurve.org/reference/api/lightkurve.correctors.PLDCorrector.correct.html?highlight=pldcorrector%20correct#lightkurve.correctors.PLDCorrector.correct">PLDCorrector.correct</a> to remove this scattered light background.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pld</span> <span class="o">=</span> <span class="n">PLDCorrector</span><span class="p">(</span><span class="n">tpf</span><span class="p">)</span>
<span class="n">corrected_lc</span> <span class="o">=</span> <span class="n">pld</span><span class="o">.</span><span class="n">correct</span><span class="p">()</span>
<span class="n">pld</span><span class="o">.</span><span class="n">diagnose</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_2-creating-light-curves_2-3-k2-pldcorrector_42_0.png" src="../../_images/tutorials_2-creating-light-curves_2-3-k2-pldcorrector_42_0.png" />
</div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">background</span></code> component of the PLD model (shown in blue in the middle panel) has successfully isolated the large spikes without fitting out the pulsations of WR 40.</p>
<p>We can also examine the apertures used to perform this correction. For <em>TESS</em>, the dominant source of noise is the scattered light background, so by default only those pixels will be used. In the third panel, we can see that the <code class="docutils literal notranslate"><span class="pre">background_aperture_mask</span></code> contains only background pixels, reducing the risk of contamination by neighboring stars.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pld</span><span class="o">.</span><span class="n">diagnose_masks</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../_images/tutorials_2-creating-light-curves_2-3-k2-pldcorrector_44_0.png" src="../../_images/tutorials_2-creating-light-curves_2-3-k2-pldcorrector_44_0.png" />
</div>
</div>
</section>
<section id="5.-Tuning-PLDCorrector-Using-Optional-Parameters">
<h2>5. Tuning <code class="docutils literal notranslate"><span class="pre">PLDCorrector</span></code> Using Optional Parameters<a class="headerlink" href="#5.-Tuning-PLDCorrector-Using-Optional-Parameters" title="Permalink to this headline">#</a></h2>
<p>In this section, we explore the optional parameters available when using the PLD method.</p>
<p>These keywords can be used to influence the performance of PLD. The PLD design matrix is constructed from three distinct submatrices, shown below with their corresponding keywords: * <strong>``background_model``</strong> * <code class="docutils literal notranslate"><span class="pre">background_aperture_mask</span></code> * <strong>``pixel_series``</strong> * <code class="docutils literal notranslate"><span class="pre">pld_order</span></code> * <code class="docutils literal notranslate"><span class="pre">pca_components</span></code> * <code class="docutils literal notranslate"><span class="pre">pld_aperture_mask</span></code> * <strong>``spline``</strong> * <code class="docutils literal notranslate"><span class="pre">spline_n_knots</span></code> * <code class="docutils literal notranslate"><span class="pre">spline_degree</span></code> * <code class="docutils literal notranslate"><span class="pre">restore_trend</span></code></p>
<section id="5.1-Definitions-of-all-additional-parameters">
<h3>5.1 Definitions of all additional parameters<a class="headerlink" href="#5.1-Definitions-of-all-additional-parameters" title="Permalink to this headline">#</a></h3>
<p>Full descriptions of each of these keywords can be found below.</p>
<p><strong>``pld_order``</strong> (<code class="docutils literal notranslate"><span class="pre">int</span></code>): * The order of Pixel Level Decorrelation to be performed. First order (<code class="docutils literal notranslate"><span class="pre">n=1</span></code>) uses only the pixel fluxes to construct the design matrix. Higher order populates the design matrix with columns constructed from the products of pixel fluxes. Default 3 for <em>K2</em> and 1 for <em>TESS</em>.</p>
<p><strong>``pca_components``</strong> (<code class="docutils literal notranslate"><span class="pre">int</span></code> or tuple of <code class="docutils literal notranslate"><span class="pre">int</span></code>): * Number of terms added to the design matrix for each order of PLD pixel fluxes. Increasing this value may provide higher precision at the expense of slower speed and/or overfitting. If performing PLD with <code class="docutils literal notranslate"><span class="pre">pld_order</span> <span class="pre">&gt;</span> <span class="pre">1</span></code>, <code class="docutils literal notranslate"><span class="pre">pca_components</span></code> can be a tuple containing the number of terms for each order of PLD. If a single <code class="docutils literal notranslate"><span class="pre">int</span></code> is passed, the same number of terms will be used for each order. If zero is passed, Principle Component Analysis
(PCA) will not be performed.</p>
<p><strong>``background_aperture_mask``</strong> (<code class="docutils literal notranslate"><span class="pre">array-like</span></code> or <code class="docutils literal notranslate"><span class="pre">None</span></code>): * A Boolean array flagging the background pixels such that <code class="docutils literal notranslate"><span class="pre">True</span></code> means that the pixel will be used to generate the background systematics model. If <code class="docutils literal notranslate"><span class="pre">None</span></code>, all pixels which are fainter than 1-sigma above the median flux will be used.</p>
<p><strong>``pld_aperture_mask``</strong> (<code class="docutils literal notranslate"><span class="pre">array-like</span></code>, <code class="docutils literal notranslate"><span class="pre">'pipeline'</span></code>, <code class="docutils literal notranslate"><span class="pre">'all'</span></code>, <code class="docutils literal notranslate"><span class="pre">'threshold'</span></code>, or <code class="docutils literal notranslate"><span class="pre">None</span></code>):</p>
<ul class="simple">
<li><p>A Boolean array describing the aperture such that <code class="docutils literal notranslate"><span class="pre">True</span></code> means that the pixel will be used when selecting the PLD basis vectors. If <code class="docutils literal notranslate"><span class="pre">None</span></code> or <code class="docutils literal notranslate"><span class="pre">all</span></code> are passed in, all pixels will be used. If <code class="docutils literal notranslate"><span class="pre">'pipeline'</span></code> is passed, the mask suggested by the official pipeline will be returned. If <code class="docutils literal notranslate"><span class="pre">'threshold'</span></code> is passed, all pixels brighter than 3-sigma above the median flux will be used.</p></li>
</ul>
<p><strong>``spline_n_knots``</strong> (<code class="docutils literal notranslate"><span class="pre">int</span></code>): * Number of knots in spline.</p>
<p><strong>``spline_degree``</strong> (<code class="docutils literal notranslate"><span class="pre">int</span></code>) * Polynomial degree of spline.</p>
<p><strong>``restore_trend``</strong> (<code class="docutils literal notranslate"><span class="pre">bool</span></code>): * Whether to restore the long-term spline trend to the light curve.</p>
<p><strong>``sparse``</strong> (<code class="docutils literal notranslate"><span class="pre">bool</span></code>): * Whether to create <code class="docutils literal notranslate"><span class="pre">SparseDesignMatrix</span></code>.</p>
<p><strong>``cadence_mask``</strong> (<code class="docutils literal notranslate"><span class="pre">np.ndarray</span></code> of <code class="docutils literal notranslate"><span class="pre">bool</span></code>) * (optional) Mask, where <code class="docutils literal notranslate"><span class="pre">True</span></code> indicates a cadence that should be used.</p>
<p><strong>``sigma``</strong> (<code class="docutils literal notranslate"><span class="pre">int</span></code>): * Standard deviation at which to remove outliers from fitting (default 5).</p>
<p><strong>``niters``</strong> (<code class="docutils literal notranslate"><span class="pre">int</span></code>) * Number of iterations to fit and remove outliers (default 5).</p>
<p><strong>``propagate_errors``</strong> (<code class="docutils literal notranslate"><span class="pre">bool</span></code>): * Whether to propagate the uncertainties from the regression. Default is <code class="docutils literal notranslate"><span class="pre">False</span></code>. Setting to <code class="docutils literal notranslate"><span class="pre">True</span></code> will increase run time, but will sample from multivariate normal distribution of weights.</p>
</section>
</section>
<section id="6.-Frequently-Asked-Questions">
<h2>6. Frequently Asked Questions<a class="headerlink" href="#6.-Frequently-Asked-Questions" title="Permalink to this headline">#</a></h2>
<p><strong>How should I select the pixels to use?</strong></p>
<p>As shown earlier, there are three aperture masks used in the <code class="docutils literal notranslate"><span class="pre">PLDCorrector</span></code>.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">aperture_mask</span></code>: Used to create the SAP flux light curve from which the noise model is subtracted. For this aperture, you should select as many pixels as possible that only contain flux from the target star. This is done automatically using a threshold mask, but it is a good idea to examine that mask with the
<a class="reference external" href="https://docs.lightkurve.org/reference/api/lightkurve.correctors.PLDCorrector.diagnose_masks.html?highlight=diagnose_masks#lightkurve.correctors.PLDCorrector.diagnose_masks">diagnose_masks</a> method to ensure it does not include background targets.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">background_aperture_mask</span></code>: Pixels used to create the background model. These pixels should not contain flux from the target star whose light curve you are attempting to correct, nor should it contain flux from background targets.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pld_aperture_mask</span></code>: Pixels used to create the correlated noise model. This aperture mask is more difficult to define, and may change on a case-by-case basis. For <em>K2</em>, this mask should contain as many pixels as possible in order to best capture the persistent motion-generated noise. For <em>TESS</em>, this mask should have less of an impact than the background mask, but should include all pixels in the cutout that do not contain background stars.</p></li>
</ul>
<p><strong>How can I speed up the correction?</strong></p>
<p>The spline <a class="reference external" href="https://docs.lightkurve.org/reference/api/lightkurve.correctors.DesignMatrix.html?highlight=designmatrix#lightkurve.correctors.DesignMatrix">DesignMatrix</a> used in <a class="reference external" href="https://docs.lightkurve.org/reference/api/lightkurve.correctors.PLDCorrector.html?highlight=pldcorrector">PLDCorrector</a> can be substituted for a <a class="reference external" href="https://docs.lightkurve.org/reference/api/lightkurve.correctors.SparseDesignMatrix.html?highlight=sparsedesignmatrix">SparseDesignMatrix</a>. These behave identically to
traditional <code class="docutils literal notranslate"><span class="pre">DesignMatrix</span></code> objects, but use <code class="docutils literal notranslate"><span class="pre">scipy.sparse</span></code> to speed up calculation and reduce memory. This can be done by passing in <code class="docutils literal notranslate"><span class="pre">sparse=True</span></code> to the <code class="docutils literal notranslate"><span class="pre">correct</span></code> method.</p>
<p><strong>What do I do if I get a singular matrix error?</strong></p>
<p>A singular matrix error occurs when a matrix used in <a class="reference external" href="https://docs.lightkurve.org/reference/api/lightkurve.correctors.RegressionCorrector.html?highlight=regressioncorrector">RegressionCorrector</a> cannot be inverted, a step necessary for optimizing the coefficients. The primary reason this occurs is that the input <code class="docutils literal notranslate"><span class="pre">DesignMatrix</span></code> has low rank relative to the number of column vectors. There are two suggested solutions to this issue: * Limit the number of input column vectors by performing
Principle Component Analysis (PCA). This is done automatically in <code class="docutils literal notranslate"><span class="pre">PLDCorrector</span></code>, but the number of output PCA vectors can be reduced using the <code class="docutils literal notranslate"><span class="pre">pca_components</span></code> keyword in the <code class="docutils literal notranslate"><span class="pre">correct</span></code> method from its default value of 16. * Ensure you are not masking out too much of your data. For instance, if you are using the <code class="docutils literal notranslate"><span class="pre">cadence_mask</span></code>, make sure that the values you want to include in your detrending are labeled as <code class="docutils literal notranslate"><span class="pre">True</span></code>. Using the inverse <code class="docutils literal notranslate"><span class="pre">cadence_mask</span></code> will often raise a singular matrix
error.</p>
</section>
<section id="About-this-Notebook">
<h2>About this Notebook<a class="headerlink" href="#About-this-Notebook" title="Permalink to this headline">#</a></h2>
<p><strong>Authors</strong>: Nicholas Saunders (<a class="reference external" href="mailto:nksaun&#37;&#52;&#48;hawaii&#46;edu">nksaun<span>&#64;</span>hawaii<span>&#46;</span>edu</a>), Geert Barentsen</p>
<p><strong>Updated</strong>: September 29, 2020</p>
</section>
<section id="Citing-Lightkurve-and-Astropy">
<h2>Citing Lightkurve and Astropy<a class="headerlink" href="#Citing-Lightkurve-and-Astropy" title="Permalink to this headline">#</a></h2>
<p>If you use <code class="docutils literal notranslate"><span class="pre">lightkurve</span></code> or its dependencies in your published research, please cite the authors. Click the buttons below to copy BibTeX entries to your clipboard.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lk</span><span class="o">.</span><span class="n">show_citation_instructions</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<head>
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

<style>
    button {
        border: 1px solid;
        padding: 0.2em;
        text-align: center;
        text-decoration: none;
        display: inline-block;
        font-size: 0.8em;
        margin: 0.2em;
        cursor: pointer;
    }

    .citation-button-1 {background-color: #4CAF50;} /* Green */
    .citation-button-2 {background-color: #008CBA;} /* Blue */
</style>

<script type="text/javascript">
    function copyBibtex(package) {
        var copyText = document.getElementById(package + "Text");
        copyText.select();
        document.execCommand("copy");
        alert("BibTex has been copied to your clipboard")
    }
</script>
</head>

<body>
    <textarea id="lightkurveText" style="position: absolute; left: -9999px; z-index: -9999;">
@MISC{2018ascl.soft12013L,
    author = {{Lightkurve Collaboration} and {Cardoso}, J.~V.~d.~M. and
                {Hedges}, C. and {Gully-Santiago}, M. and {Saunders}, N. and
                {Cody}, A.~M. and {Barclay}, T. and {Hall}, O. and
                {Sagear}, S. and {Turtelboom}, E. and {Zhang}, J. and
                {Tzanidakis}, A. and {Mighell}, K. and {Coughlin}, J. and
                {Bell}, K. and {Berta-Thompson}, Z. and {Williams}, P. and
                {Dotson}, J. and {Barentsen}, G.},
    title = "{Lightkurve: Kepler and TESS time series analysis in Python}",
    keywords = {Software, NASA},
howpublished = {Astrophysics Source Code Library},
        year = 2018,
    month = dec,
archivePrefix = "ascl",
    eprint = {1812.013},
    adsurl = {http://adsabs.harvard.edu/abs/2018ascl.soft12013L},
}
    </textarea>
    <textarea id="astropyText" style="position: absolute; left: -9999px; z-index: -9999;">
@ARTICLE{astropy:2022,
       author = {{Astropy Collaboration} and {Price-Whelan}, Adrian M. and {Lim}, Pey
       Lian and {Earl}, Nicholas and {Starkman}, Nathaniel and {Bradley}, Larry and
       {Shupe}, David L. and {Patil}, Aarya A. and {Corrales}, Lia and {Brasseur}, C.~E.
       and {N{\"o}the}, Maximilian and {Donath}, Axel and {Tollerud}, Erik and {Morris},
       Brett M. and {Ginsburg}, Adam and {Vaher}, Eero and {Weaver}, Benjamin A. and
       {Tocknell}, James and {Jamieson}, William and {van Kerkwijk}, Marten H. and
       {Robitaille}, Thomas P. and {Merry}, Bruce and {Bachetti}, Matteo and
       {G{\"u}nther}, H. Moritz and {Aldcroft}, Thomas L. and {Alvarado-Montes}, Jaime
       A. and {Archibald}, Anne M. and {B{\'o}di}, Attila and {Bapat}, Shreyas and
       {Barentsen}, Geert and {Baz{\'a}n}, Juanjo and {Biswas}, Manish and {Boquien},
       M{\'e}d{\'e}ric and {Burke}, D.~J. and {Cara}, Daria and {Cara}, Mihai and
       {Conroy}, Kyle E. and {Conseil}, Simon and {Craig}, Matthew W. and {Cross},
       Robert M. and {Cruz}, Kelle L. and {D'Eugenio}, Francesco and {Dencheva}, Nadia
       and {Devillepoix}, Hadrien A.~R. and {Dietrich}, J{\"o}rg P. and {Eigenbrot},
       Arthur Davis and {Erben}, Thomas and {Ferreira}, Leonardo and {Foreman-Mackey},
       Daniel and {Fox}, Ryan and {Freij}, Nabil and {Garg}, Suyog and {Geda}, Robel and
       {Glattly}, Lauren and {Gondhalekar}, Yash and {Gordon}, Karl D. and {Grant},
       David and {Greenfield}, Perry and {Groener}, Austen M. and {Guest}, Steve and
       {Gurovich}, Sebastian and {Handberg}, Rasmus and {Hart}, Akeem and
       {Hatfield-Dodds}, Zac and {Homeier}, Derek and {Hosseinzadeh}, Griffin and
       {Jenness}, Tim and {Jones}, Craig K. and {Joseph}, Prajwel and {Kalmbach}, J.
       Bryce and {Karamehmetoglu}, Emir and {Ka{\l}uszy{\'n}ski}, Miko{\l}aj and
       {Kelley}, Michael S.~P. and {Kern}, Nicholas and {Kerzendorf}, Wolfgang E. and
       {Koch}, Eric W. and {Kulumani}, Shankar and {Lee}, Antony and {Ly}, Chun and
       {Ma}, Zhiyuan and {MacBride}, Conor and {Maljaars}, Jakob M. and {Muna}, Demitri
       and {Murphy}, N.~A. and {Norman}, Henrik and {O'Steen}, Richard and {Oman}, Kyle
       A. and {Pacifici}, Camilla and {Pascual}, Sergio and {Pascual-Granado}, J. and
       {Patil}, Rohit R. and {Perren}, Gabriel I. and {Pickering}, Timothy E. and
       {Rastogi}, Tanuj and {Roulston}, Benjamin R. and {Ryan}, Daniel F. and {Rykoff},
       Eli S. and {Sabater}, Jose and {Sakurikar}, Parikshit and {Salgado}, Jes{\'u}s
       and {Sanghi}, Aniket and {Saunders}, Nicholas and {Savchenko}, Volodymyr and
       {Schwardt}, Ludwig and {Seifert-Eckert}, Michael and {Shih}, Albert Y. and
       {Jain}, Anany Shrey and {Shukla}, Gyanendra and {Sick}, Jonathan and {Simpson},
       Chris and {Singanamalla}, Sudheesh and {Singer}, Leo P. and {Singhal}, Jaladh and
       {Sinha}, Manodeep and {Sip{\H{o}}cz}, Brigitta M. and {Spitler}, Lee R. and
       {Stansby}, David and {Streicher}, Ole and {{\v{S}}umak}, Jani and {Swinbank},
       John D. and {Taranu}, Dan S. and {Tewary}, Nikita and {Tremblay}, Grant R. and
       {Val-Borro}, Miguel de and {Van Kooten}, Samuel J. and {Vasovi{\'c}}, Zlatan and
       {Verma}, Shresth and {de Miranda Cardoso}, Jos{\'e} Vin{\'\i}cius and {Williams},
       Peter K.~G. and {Wilson}, Tom J. and {Winkel}, Benjamin and {Wood-Vasey}, W.~M.
       and {Xue}, Rui and {Yoachim}, Peter and {Zhang}, Chen and {Zonca}, Andrea and
       {Astropy Project Contributors}}, title = "{The Astropy Project: Sustaining and
       Growing a Community-oriented Open-source Project and the Latest Major Release
       (v5.0) of the Core Package}",
      journal = {\apj},
     keywords = {Astronomy software, Open source software, Astronomy data analysis, 1855, 1866, 1858, Astrophysics - Instrumentation and Methods for Astrophysics},
         year = 2022,
        month = aug,
       volume = {935},
       number = {2},
          eid = {167},
        pages = {167},
          doi = {10.3847/1538-4357/ac7c74},
archivePrefix = {arXiv},
       eprint = {2206.14220},
 primaryClass = {astro-ph.IM},
       adsurl = {https://ui.adsabs.harvard.edu/abs/2022ApJ...935..167A},
      adsnote = {Provided by the SAO/NASA Astrophysics Data System}
}


    </textarea>
    <textarea id="astroqueryText" style="position: absolute; left: -9999px; z-index: -9999;">
@ARTICLE{2019AJ....157...98G,
   author = {{Ginsburg}, A. and {Sip{\H o}cz}, B.~M. and {Brasseur}, C.~E. and
    {Cowperthwaite}, P.~S. and {Craig}, M.~W. and {Deil}, C. and
    {Guillochon}, J. and {Guzman}, G. and {Liedtke}, S. and {Lian Lim}, P. and
    {Lockhart}, K.~E. and {Mommert}, M. and {Morris}, B.~M. and
    {Norman}, H. and {Parikh}, M. and {Persson}, M.~V. and {Robitaille}, T.~P. and
    {Segovia}, J.-C. and {Singer}, L.~P. and {Tollerud}, E.~J. and
    {de Val-Borro}, M. and {Valtchanov}, I. and {Woillez}, J. and
    {The Astroquery collaboration} and {a subset of the astropy collaboration}
    },
    title = "{astroquery: An Astronomical Web-querying Package in Python}",
  journal = {\aj},
archivePrefix = "arXiv",
   eprint = {1901.04520},
 primaryClass = "astro-ph.IM",
 keywords = {astronomical databases: miscellaneous, virtual observatory tools},
     year = 2019,
    month = mar,
   volume = 157,
      eid = {98},
    pages = {98},
      doi = {10.3847/1538-3881/aafc33},
   adsurl = {http://adsabs.harvard.edu/abs/2019AJ....157...98G},
  adsnote = {Provided by the SAO/NASA Astrophysics Data System}
}

    </textarea>
    <textarea id="tesscutText" style="position: absolute; left: -9999px; z-index: -9999;">
@MISC{2019ascl.soft05007B,
        author = {{Brasseur}, C.~E. and {Phillip}, Carlita and {Fleming}, Scott W. and
          {Mullally}, S.~E. and {White}, Richard L.},
         title = "{Astrocut: Tools for creating cutouts of TESS images}",
      keywords = {Software},
          year = 2019,
         month = may,
           eid = {ascl:1905.007},
         pages = {ascl:1905.007},
 archivePrefix = {ascl},
        eprint = {1905.007},
        adsurl = {https://ui.adsabs.harvard.edu/abs/2019ascl.soft05007B},
       adsnote = {Provided by the SAO/NASA Astrophysics Data System}
 }
    </textarea>

    <p>
        When using Lightkurve, we kindly request that you cite the following packages:
        <ul>
            <li>
                <a href="https://docs.lightkurve.org">lightkurve</a>
                <button onclick="copyBibtex('lightkurve')"><i class="fas fa-clipboard"></i> Copy BibTeX</button>
            </li>
            <li>
                <a href="https://astropy.org">astropy</a>
                <button onclick="copyBibtex('astropy')"><i class="fas fa-clipboard"></i> Copy BibTeX</button>
            </li>
            <li>
                <a href="https://astroquery.readthedocs.io">astroquery</a>
                <button onclick="copyBibtex('astroquery')"><i class="fas fa-clipboard"></i> Copy BibTeX</button>
                —  if you are using <i>search_lightcurve()</i> or <i>search_targetpixelfile()</i>.
            </li>
            <li>
                <a href="https://mast.stsci.edu/tesscut/">tesscut</a>
                <button onclick="copyBibtex('tesscut')"><i class="fas fa-clipboard"></i> Copy BibTeX</button>
                — if you are using <i>search_tesscut()</i>.
            </li>
        </ul>
    </p>
</body></div>
</div>
<p><img alt="Space Telescope Logo" class="no-scaled-link" src="https://raw.githubusercontent.com/spacetelescope/notebooks/master/assets/stsci_pri_combo_mark_horizonal_white_bkgd.png" style="width: 200px;" /></p>
</section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="2-3-removing-scattered-light-using-regressioncorrector.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Removing scattered light from <em>TESS</em> light curves using linear regression (<code class="docutils literal notranslate"><span class="pre">RegressionCorrector</span></code>)</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="2-3-k2-sffcorrector.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Removing noise from K2 light curves using Self Flat Fielding (<code class="docutils literal notranslate"><span class="pre">SFFCorrector</span></code>)</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright Lightkurve developers.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.5.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>