

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>How to perform PRF photometry? &mdash; lightkurve 1.0b14 documentation</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="How to cut out Target Pixel Files from Kepler Superstamps or TESS FFIs?" href="cutting-out-tpfs-from-tess-ffis.html" />
    <link rel="prev" title="How to perform aperture photometry with custom apertures?" href="2.05-making-custom-apertures.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> lightkurve
          

          
            
            <img src="../_static/lightkurve.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1.0b14
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="section1.html">Introduction to lightkurve</a></li>
<li class="toctree-l1"><a class="reference internal" href="section2.html">Science with lightkurve</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="section3.html">Extracting lightcurves</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="2.05-making-custom-apertures.html">How to perform aperture photometry with custom apertures?</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">How to perform PRF photometry?</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Table-of-contents">Table of contents</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Simple-example:-PRF-photometry-of-Kepler-10">Simple example: PRF photometry of Kepler-10</a></li>
<li class="toctree-l3"><a class="reference internal" href="#The-TPFModel-object">The <code class="docutils literal notranslate"><span class="pre">TPFModel</span></code> object</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Visualizing-and-fitting-a-TPFModel-object">Visualizing and fitting a <code class="docutils literal notranslate"><span class="pre">TPFModel</span></code> object</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Changing-TPFModel-priors">Changing <code class="docutils literal notranslate"><span class="pre">TPFModel</span></code> priors</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Creating-lightcurves-with-a-custom-TPFModel-object">Creating lightcurves with a custom <code class="docutils literal notranslate"><span class="pre">TPFModel</span></code> object</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Comments?">Comments?</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="cutting-out-tpfs-from-tess-ffis.html">How to cut out Target Pixel Files from Kepler Superstamps or TESS FFIs?</a></li>
<li class="toctree-l2"><a class="reference internal" href="2.08-making-fits-files.html">How to save a lightcurve in FITS format?</a></li>
<li class="toctree-l2"><a class="reference internal" href="2.03-appending-lightcurves.html">How to combine lightcurves from different Kepler quarters</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="section4.html">Systematics correction</a></li>
</ul>
<p class="caption"><span class="caption-text">About lightkurve</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing and reporting issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../citing.html">Citing and acknowledging lightkurve</a></li>
<li class="toctree-l1"><a class="reference internal" href="../other_software.html">Other software</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">lightkurve</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="section3.html">Extracting lightcurves</a> &raquo;</li>
        
      <li>How to perform PRF photometry?</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/tutorials/2.10-how-to-use-prf-photometry.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 8ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}
</style>
<div class="section" id="How-to-perform-PRF-photometry?">
<h1>How to perform PRF photometry?<a class="headerlink" href="#How-to-perform-PRF-photometry?" title="Permalink to this headline">¶</a></h1>
<p>In previous tutorials we discussed <a class="reference external" href="1.03-what-are-lightcurves.html">how aperture photometry
works</a> and how you can <a class="reference external" href="2.05-making-custom-apertures.html">create your
own custom masks</a> to extract
aperture photometry.</p>
<p>As a reminder, aperture photometry works by summing up the flux values
across all the pixels in a pre-defined mask. It tends to offer the
fastest and most robust way to extract photometry for an isolated star,
but it suffers from the three limitations: 1. When two or more stars
overlap, aperture photometry will return the sum of the flux of all
stars. Separating their signals requires additional assumptions. 2. When
the telescope experience motion or focus changes, the fraction of the
flux of a star captured by the pre-defined aperture mask will change.
This imposes systematics on the data which need to be removed
(e.g.&nbsp;using the CBV or SFF techniques). 3. It may be difficult to
separate a background signal from the lightcurve of a star. In
particular, this is a concern when time-varying background signals are
present, such as the so-called “rolling bands” in Kepler.</p>
<p>An alternative to aperture photometry which addresses the above
limitations is called called <em>Point Response Function (PRF) model
fitting photometry</em>, also known as <em>Point Spread Function (PSF) fitting
photometry</em> or <em>PRF (PSF) photometry</em> in short. In this method, a
parameterized model is fit to the data. This method is significantly
more complicated then aperture photometry and is prone to a different
set of systematics. However it offers the ability to separate the
signals of overlapping stars in very crowded regions or star clusters.</p>
<p>This tutorial demonstrates how <em>lightkurve</em> can be used to extract
lightcurves using the model fitting technique. We will start with an
easy example and then show how you can tune the parameters of the model
to create more careful analyses.</p>
<div class="section" id="Table-of-contents">
<h2>Table of contents<a class="headerlink" href="#Table-of-contents" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li>Simple example: PRF photometry of Kepler-10</li>
<li>The <code class="docutils literal notranslate"><span class="pre">TPFModel</span></code> object</li>
<li>Visualizing and fitting a <code class="docutils literal notranslate"><span class="pre">TPFModel</span></code> object</li>
<li>Changing <code class="docutils literal notranslate"><span class="pre">TPFModel</span></code> priors</li>
<li>Creating lightcurves with a custom <code class="docutils literal notranslate"><span class="pre">TPFModel</span></code> object</li>
</ol>
</div>
<div class="section" id="Simple-example:-PRF-photometry-of-Kepler-10">
<h2>Simple example: PRF photometry of Kepler-10<a class="headerlink" href="#Simple-example:-PRF-photometry-of-Kepler-10" title="Permalink to this headline">¶</a></h2>
<p>Let’s start with a simple example by obtaining PRF photometry for planet
system <em>Kepler-10</em>. We start by downloading the pixel data from the
archive:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">lightkurve</span> <span class="k">import</span> <span class="n">KeplerTargetPixelFile</span>
<span class="n">tpf</span> <span class="o">=</span> <span class="n">KeplerTargetPixelFile</span><span class="o">.</span><span class="n">from_archive</span><span class="p">(</span><span class="s2">&quot;Kepler-10&quot;</span><span class="p">,</span> <span class="n">quarter</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">quality_bitmask</span><span class="o">=</span><span class="s1">&#39;hardest&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The easiest way to get PRF photometry is to simply call the
<code class="docutils literal notranslate"><span class="pre">to_lightcurve</span></code> method with parameter <code class="docutils literal notranslate"><span class="pre">method='prf'</span></code>. This will fit
the pixel data of all cadences with a default model and return the
lightcurve.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">lc</span> <span class="o">=</span> <span class="n">tpf</span><span class="o">.</span><span class="n">to_lightcurve</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;prf&#39;</span><span class="p">)</span>
<span class="n">lc</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
Warning: PRF-fitting photometry is experimental in this version of lightkurve.
Fitting cadences: 100%|██████████| 3634/3634 [00:59&lt;00:00, 60.90it/s]
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[2]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7ff5f4920908&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_2.10-how-to-use-prf-photometry_3_2.png" src="../_images/tutorials_2.10-how-to-use-prf-photometry_3_2.png" />
</div>
</div>
<p>A good way to verify that the model-fitting photometry produced a
sensible output is by comparing it against standard aperture photometry.
You can obtain aperture photometry using the same <code class="docutils literal notranslate"><span class="pre">to_lightcurve</span></code>
method and the parameter <code class="docutils literal notranslate"><span class="pre">method='aperture'</span></code> (which is the default
value of this parameter).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">lc_aper</span> <span class="o">=</span> <span class="n">tpf</span><span class="o">.</span><span class="n">to_lightcurve</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;aperture&#39;</span><span class="p">)</span>
<span class="n">lc_aper</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[3]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7ff5f836ccc0&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_2.10-how-to-use-prf-photometry_5_1.png" src="../_images/tutorials_2.10-how-to-use-prf-photometry_5_1.png" />
</div>
</div>
<p>There is a notable difference in the long-term trend in both
lightcurves. This is because PRF-fitting photometry yields a local
estimate of the background which is often different from the Kepler
pipeline’s global background level estimates.</p>
<p>Let’s fold both lightcurves on the period of the known planet <em>Kepler-10
b</em> to show that the transit can be recovered equally well:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;PRF photometry&#39;</span><span class="p">)</span>
<span class="n">lc</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">fold</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="mf">0.8376</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Aperture photometry&#39;</span><span class="p">)</span>
<span class="n">lc_aper</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span><span class="o">.</span><span class="n">fold</span><span class="p">(</span><span class="n">period</span><span class="o">=</span><span class="mf">0.8376</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[4]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7ff5f816ad68&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_2.10-how-to-use-prf-photometry_7_1.png" src="../_images/tutorials_2.10-how-to-use-prf-photometry_7_1.png" />
</div>
</div>
<p>Success! Note that the outliers between <em>phase</em> -0.4 and 0.0 are caused
by the transits of another planet with a different period.</p>
<p>Note that PRF photometry appears to offer a few percent less noise
compared to its aperture counterpart:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;The CDPP noise metric equals:</span>
<span class="si">{:.1f}</span><span class="s2"> ppm for PRF-fitting photometry;</span>
<span class="si">{:.1f}</span><span class="s2"> ppm for aperture photometry.&quot;&quot;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lc</span><span class="o">.</span><span class="n">cdpp</span><span class="p">(),</span> <span class="n">lc_aper</span><span class="o">.</span><span class="n">cdpp</span><span class="p">()))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
The CDPP noise metric equals:
32.4 ppm for PRF-fitting photometry;
32.7 ppm for aperture photometry.
</pre></div></div>
</div>
<p>This is all you need to know to get started with PRF photometry! In what
follows, we explain how you can tune the parameters of the model
fitting.</p>
</div>
<div class="section" id="The-TPFModel-object">
<h2>The <code class="docutils literal notranslate"><span class="pre">TPFModel</span></code> object<a class="headerlink" href="#The-TPFModel-object" title="Permalink to this headline">¶</a></h2>
<p>It is often possible to obtain better results by carefully tuning the
model that is being fit to the data. This is true in particular when the
data contain multiple overlapping stars. Let’s have a look at how you
can interact and change the model.</p>
<p><em>Lightkurve</em> uses objects of type <code class="docutils literal notranslate"><span class="pre">TPFModel</span></code> to specify the model. You
can obtain the default model using the <code class="docutils literal notranslate"><span class="pre">get_model()</span></code> method:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">model</span> <span class="o">=</span> <span class="n">tpf</span><span class="o">.</span><span class="n">get_model</span><span class="p">()</span>
<span class="nb">type</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[6]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>lightkurve.prf.tpfmodel.TPFModel
</pre></div>
</div>
</div>
<p>A <code class="docutils literal notranslate"><span class="pre">TPFModel</span></code> object encapsulates our beliefs about the stars contained
in a pixel file. The key parameters are:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">model.star_priors</span></code> captures our prior beliefs about the positions
and fluxes of the point sources in the data using a list of
<code class="docutils literal notranslate"><span class="pre">StarPrior</span></code> objects. Each <code class="docutils literal notranslate"><span class="pre">StarPrior</span></code> object is parameterized by
<code class="docutils literal notranslate"><span class="pre">col</span></code> and <code class="docutils literal notranslate"><span class="pre">row</span></code> in pixel coordinates and <code class="docutils literal notranslate"><span class="pre">flux</span></code> in
electrons/second;</li>
<li><code class="docutils literal notranslate"><span class="pre">model.background_prior</span></code> captures our beliefs about the per-pixel
background, parameterized by <code class="docutils literal notranslate"><span class="pre">flux</span></code> in electrons/second;</li>
<li><code class="docutils literal notranslate"><span class="pre">model.focus_prior</span></code> captures our beliefs on the focus of the
spacecraft, parameterized by the unit-less stretch factors
<code class="docutils literal notranslate"><span class="pre">scale_col</span></code> and <code class="docutils literal notranslate"><span class="pre">scale_row</span></code>, and <code class="docutils literal notranslate"><span class="pre">rotation_angle</span></code> in radians;</li>
<li><code class="docutils literal notranslate"><span class="pre">model.motion_prior</span></code> captures our beliefs about spacecraft motion,
parameterized by <code class="docutils literal notranslate"><span class="pre">shift_col</span></code> and <code class="docutils literal notranslate"><span class="pre">shift_row</span></code> in pixel
coordinates;</li>
<li><code class="docutils literal notranslate"><span class="pre">model.prfmodel</span></code> an object of type <code class="docutils literal notranslate"><span class="pre">KeplerPRF</span></code> which models the
Point Response Function.</li>
<li><code class="docutils literal notranslate"><span class="pre">model.fit_background</span></code>, <code class="docutils literal notranslate"><span class="pre">model.fit_focus</span></code>, and
<code class="docutils literal notranslate"><span class="pre">model.fit_motion</span></code> are booleans which indicate whether or not the
background, focus, and motion parameters should be considered free
parameters, i.e.&nbsp;whether or not our beliefs should assumed to be
perfect.</li>
</ul>
<p>The parameters of each of these components are prior distributions.</p>
<p>We can inspect the our beliefs by accessing the properties, for example,
this is the prior on the column pixel coordinate of the star in our
data:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">model</span><span class="o">.</span><span class="n">star_priors</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">col</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[7]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;GaussianPrior(mean=[655.70045778], var=[0.00046541])&gt;
</pre></div>
</div>
</div>
<p>And this is the model’s prior on the background flux:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">model</span><span class="o">.</span><span class="n">background_prior</span><span class="o">.</span><span class="n">flux</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[8]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;GaussianPrior(mean=[140.05336], var=[145.87004587])&gt;
</pre></div>
</div>
</div>
<p>We can inspect all the parameters at once using the <code class="docutils literal notranslate"><span class="pre">print</span></code> function:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="nb">print</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;lightkurve.prf.tpfmodel.TPFModel object at 0x7ff5f4ade940&gt;
  &lt;StarPrior(
    col=&lt;GaussianPrior(mean=[655.70045778], var=[0.00046541])&gt;
    row=&lt;GaussianPrior(mean=[246.83753465], var=[0.0007464])&gt;
    flux=&lt;UniformPrior(lb=[83941.5390625], ub=[1066484.375])&gt;
    targetid=11904151)&gt;
  &lt;BackgroundPrior(
    flux=&lt;GaussianPrior(mean=[140.05336], var=[145.87004587])&gt;)&gt;
  &lt;FocusPrior(
    scale_col=&lt;GaussianPrior(mean=[1], var=[0.0001])&gt;
    scale_row=&lt;GaussianPrior(mean=[1], var=[0.0001])&gt;
    rotation_angle=&lt;UniformPrior(lb=[-3.1415], ub=[3.1415])&gt;)&gt;
  &lt;MotionPrior(
    shift_col=&lt;GaussianPrior(mean=[0], var=[1.])&gt;
    shift_row=&lt;GaussianPrior(mean=[0], var=[1.])&gt;)&gt;
  &lt;lightkurve.prf.prfmodel.KeplerPRF object at 0x7ff5f4adee80&gt;
  fit_background=True
  fit_focus=False
  fit_motion=False

</pre></div></div>
</div>
</div>
<div class="section" id="Visualizing-and-fitting-a-TPFModel-object">
<h2>Visualizing and fitting a <code class="docutils literal notranslate"><span class="pre">TPFModel</span></code> object<a class="headerlink" href="#Visualizing-and-fitting-a-TPFModel-object" title="Permalink to this headline">¶</a></h2>
<p>A <code class="docutils literal notranslate"><span class="pre">TPFModel</span></code> object contains several methods to interact with the
model. For example, you can visualize the default prediction using the
<code class="docutils literal notranslate"><span class="pre">plot()</span></code> method. This will visualize the model prediction using the
prior means. Let’s plot the model below (left panel) and compare it
against the observed data (right panel):</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">tpf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_2.10-how-to-use-prf-photometry_20_0.png" src="../_images/tutorials_2.10-how-to-use-prf-photometry_20_0.png" />
</div>
</div>
<p>You can fit the model to a single cadence of pixel data using the
<code class="docutils literal notranslate"><span class="pre">fit()</span></code> method, which returns an object of type <code class="docutils literal notranslate"><span class="pre">TPFModelParameters</span></code>
which encapulsates the maximum likelihood values of the parameters for
that cadence:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">parameters</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">tpf</span><span class="o">.</span><span class="n">flux</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">tpf</span><span class="o">.</span><span class="n">flux_bkg</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;lightkurve.prf.tpfmodel.TPFModelParameters object at 0x7ff5f4adefd0&gt;
  &lt;StarParameters(
    col=655.6410020402017
    row=246.75968163502935
    flux=528781.7188502487
    targetid=None)&gt;
  &lt;BackgroundParameters(
    flux=175.2389710561001
    fitted=True)&gt;
  &lt;FocusParameters(
    scale_col=[1]
    scale_row=[1]
    rotation_angle=[0.]
    fitted=False)&gt;
  &lt;MotionParameters(
    shift_col=[0]
    shift_row=[0]
    fitted=False)&gt;
  residual_image:
    [ 13.5211913  -24.99054271 -36.49246532 -36.4521516 ...
  predicted_image:
    [175.23897106 175.23897106 175.23897106 175.23897106...

</pre></div></div>
</div>
<p>For example, we can access the maximum likelihood value of the stellar
flux as follows:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">parameters</span><span class="o">.</span><span class="n">stars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flux</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[12]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>528781.7188502487
</pre></div>
</div>
</div>
<p>And the background flux was found to be:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">parameters</span><span class="o">.</span><span class="n">background</span><span class="o">.</span><span class="n">flux</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[13]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>175.2389710561001
</pre></div>
</div>
</div>
<p>We can visualize the model again, this time passing the fitted
parameters:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">tpf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[14]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7ff5f4daa5c0&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_2.10-how-to-use-prf-photometry_28_1.png" src="../_images/tutorials_2.10-how-to-use-prf-photometry_28_1.png" />
</div>
</div>
</div>
<div class="section" id="Changing-TPFModel-priors">
<h2>Changing <code class="docutils literal notranslate"><span class="pre">TPFModel</span></code> priors<a class="headerlink" href="#Changing-TPFModel-priors" title="Permalink to this headline">¶</a></h2>
<p>We can change a <code class="docutils literal notranslate"><span class="pre">TPFModel</span></code> by manipulating its properties. For
example, we can add a star to the lower right corner of the pixel file
as follows:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">lightkurve.prf</span> <span class="k">import</span> <span class="n">StarPrior</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">tpf</span><span class="o">.</span><span class="n">get_model</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">star_priors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">StarPrior</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="mi">660</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="mi">243</span><span class="p">,</span> <span class="n">flux</span><span class="o">=</span><span class="mf">1e6</span><span class="p">))</span>
<span class="n">model</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_2.10-how-to-use-prf-photometry_31_0.png" src="../_images/tutorials_2.10-how-to-use-prf-photometry_31_0.png" />
</div>
</div>
<p>Alternatively, you can build a <code class="docutils literal notranslate"><span class="pre">TPFModel</span></code> from scratch. In the example
below, we use an arbitrary combination of Gaussian, Uniform, and Fixed
priors to initialize a model. Note that the ideal choices for these
assumptions depend strongly on your scientific objectives and may
require trial-and-error.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">lightkurve.prf</span> <span class="k">import</span> <span class="n">TPFModel</span><span class="p">,</span> <span class="n">StarPrior</span><span class="p">,</span> <span class="n">BackgroundPrior</span><span class="p">,</span> <span class="n">FocusPrior</span><span class="p">,</span> <span class="n">MotionPrior</span>
<span class="kn">from</span> <span class="nn">lightkurve.prf</span> <span class="k">import</span> <span class="n">GaussianPrior</span><span class="p">,</span> <span class="n">UniformPrior</span><span class="p">,</span> <span class="n">FixedValuePrior</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">TPFModel</span><span class="p">(</span><span class="n">star_priors</span><span class="o">=</span><span class="p">[</span><span class="n">StarPrior</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="n">GaussianPrior</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mi">656</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                                        <span class="n">row</span><span class="o">=</span><span class="n">GaussianPrior</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mi">247</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                                        <span class="n">flux</span><span class="o">=</span><span class="n">UniformPrior</span><span class="p">(</span><span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="mf">1e7</span><span class="p">)),</span>
                              <span class="n">StarPrior</span><span class="p">(</span><span class="n">col</span><span class="o">=</span><span class="n">FixedValuePrior</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">660</span><span class="p">),</span>
                                        <span class="n">row</span><span class="o">=</span><span class="n">FixedValuePrior</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">243</span><span class="p">),</span>
                                        <span class="n">flux</span><span class="o">=</span><span class="n">UniformPrior</span><span class="p">(</span><span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="mf">1e7</span><span class="p">))],</span>
                 <span class="n">background_prior</span><span class="o">=</span><span class="n">BackgroundPrior</span><span class="p">(</span><span class="n">flux</span><span class="o">=</span><span class="n">GaussianPrior</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">100.</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="mf">10.</span><span class="p">)),</span>
                 <span class="n">focus_prior</span><span class="o">=</span><span class="n">FocusPrior</span><span class="p">(</span><span class="n">scale_col</span><span class="o">=</span><span class="n">GaussianPrior</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">),</span>
                                        <span class="n">scale_row</span><span class="o">=</span><span class="n">GaussianPrior</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">),</span>
                                        <span class="n">rotation_angle</span><span class="o">=</span><span class="n">UniformPrior</span><span class="p">(</span><span class="n">lb</span><span class="o">=-</span><span class="mf">3.1415</span><span class="p">,</span> <span class="n">ub</span><span class="o">=</span><span class="mf">3.1415</span><span class="p">)),</span>
                 <span class="n">motion_prior</span><span class="o">=</span><span class="n">MotionPrior</span><span class="p">(</span><span class="n">shift_col</span><span class="o">=</span><span class="n">GaussianPrior</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="mf">0.01</span><span class="p">),</span>
                                          <span class="n">shift_row</span><span class="o">=</span><span class="n">GaussianPrior</span><span class="p">(</span><span class="n">mean</span><span class="o">=</span><span class="mf">0.</span><span class="p">,</span> <span class="n">var</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)),</span>
                 <span class="n">prfmodel</span><span class="o">=</span><span class="n">tpf</span><span class="o">.</span><span class="n">get_prf_model</span><span class="p">(),</span>
                 <span class="n">fit_background</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                 <span class="n">fit_focus</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">fit_motion</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_2.10-how-to-use-prf-photometry_33_0.png" src="../_images/tutorials_2.10-how-to-use-prf-photometry_33_0.png" />
</div>
</div>
</div>
<div class="section" id="Creating-lightcurves-with-a-custom-TPFModel-object">
<h2>Creating lightcurves with a custom <code class="docutils literal notranslate"><span class="pre">TPFModel</span></code> object<a class="headerlink" href="#Creating-lightcurves-with-a-custom-TPFModel-object" title="Permalink to this headline">¶</a></h2>
<p>Above we demonstrated how you can interact with a <code class="docutils literal notranslate"><span class="pre">TPFModel</span></code> and fit
its parameters to a single cadence. Most users will be interested in
obtaining a lightcurve by fitting the model to <em>all</em> the cadences rather
than a single one.</p>
<p>To make this easy, <em>lightkurve</em> provides a helper class called
<code class="docutils literal notranslate"><span class="pre">PRFPhotometry</span></code>, which makes it easy to fit the model to all cadences
and inspect the results. For example:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">lightkurve</span> <span class="k">import</span> <span class="n">PRFPhotometry</span>
<span class="n">prfphot</span> <span class="o">=</span> <span class="n">PRFPhotometry</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">tpf</span><span class="o">.</span><span class="n">get_model</span><span class="p">())</span>
<span class="n">prfphot</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tpf</span><span class="o">.</span><span class="n">flux</span> <span class="o">+</span> <span class="n">tpf</span><span class="o">.</span><span class="n">flux_bkg</span><span class="p">)</span>
<span class="n">prfphot</span><span class="o">.</span><span class="n">plot_results</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
Fitting cadences: 100%|██████████| 3634/3634 [00:47&lt;00:00, 76.85it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_2.10-how-to-use-prf-photometry_36_1.png" src="../_images/tutorials_2.10-how-to-use-prf-photometry_36_1.png" />
</div>
</div>
<p>You can access the details of the fit in each cadence using the
<code class="docutils literal notranslate"><span class="pre">prfphot.results</span></code> property, e.g.:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">prfphot</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">flux</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[18]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>528781.7188502487
</pre></div>
</div>
</div>
<p>Alternative, you can access the fitted fluxes as a <code class="docutils literal notranslate"><span class="pre">LightCurve</span></code>
object:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">prfphot</span><span class="o">.</span><span class="n">lightcurves</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[19]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;lightkurve.lightcurve.LightCurve at 0x7ff5f4b312e8&gt;
</pre></div>
</div>
</div>
<p>Note that the focus and motion parameters in the example above are
constant. This is because the <code class="docutils literal notranslate"><span class="pre">fit_focus</span></code> and <code class="docutils literal notranslate"><span class="pre">fit_motion</span></code>
parameters were set to <code class="docutils literal notranslate"><span class="pre">False</span></code> in the model. By setting these to
<code class="docutils literal notranslate"><span class="pre">True</span></code>, we can potentially improve the quality of the fit. Beware
however, this comes at the cost of slowing down the fitting process and
potentially introducing more complicated systematics and parameter
degeneracies.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">prfphot</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fit_focus</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">prfphot</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">fit_motion</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">prfphot</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tpf</span><span class="o">.</span><span class="n">flux</span> <span class="o">+</span> <span class="n">tpf</span><span class="o">.</span><span class="n">flux_bkg</span><span class="p">)</span>
<span class="n">prfphot</span><span class="o">.</span><span class="n">plot_results</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="stderr output_area docutils container">
<div class="highlight"><pre>
Fitting cadences: 100%|██████████| 3634/3634 [03:04&lt;00:00, 19.69it/s]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_2.10-how-to-use-prf-photometry_42_1.png" src="../_images/tutorials_2.10-how-to-use-prf-photometry_42_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>In [21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">prfphot</span><span class="o">.</span><span class="n">lightcurves</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre>
<span></span>Out[21]:
</pre></div>
</div>
<div class="output_area highlight-none notranslate"><div class="highlight"><pre>
<span></span>&lt;matplotlib.axes._subplots.AxesSubplot at 0x7ff5f44d0438&gt;
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/tutorials_2.10-how-to-use-prf-photometry_43_1.png" src="../_images/tutorials_2.10-how-to-use-prf-photometry_43_1.png" />
</div>
</div>
<p>Uhoh, the increased model flexibility introduced complicated
systematics. These systematics are caused in part by the degeneracy
between the star’s <code class="docutils literal notranslate"><span class="pre">col</span></code> and <code class="docutils literal notranslate"><span class="pre">row</span></code> position and the <code class="docutils literal notranslate"><span class="pre">shift_col</span></code>
and <code class="docutils literal notranslate"><span class="pre">shift_row</span></code> parameters. The degeneracy will disappear when
additional stars are present in the data, or when tighter priors are
employed.</p>
</div>
<div class="section" id="Comments?">
<h2>Comments?<a class="headerlink" href="#Comments?" title="Permalink to this headline">¶</a></h2>
<p>At present we are evaluating the design and use of <em>lightkurve</em>’s PRF
photometry for use in crowded fields. If you encounter issues, or would
like to contribute a tutorial or working example, then please open an
issue or pull request on GitHub!</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="cutting-out-tpfs-from-tess-ffis.html" class="btn btn-neutral float-right" title="How to cut out Target Pixel Files from Kepler Superstamps or TESS FFIs?" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="2.05-making-custom-apertures.html" class="btn btn-neutral" title="How to perform aperture photometry with custom apertures?" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright lightkurve developers and contributors.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0b14',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>